<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Xml files with Talend - Hello, world! I'm Julien Wazné</title>

  <!-- Edit site and author settings in `_config.yml` to make the social details your own -->

    <meta content="Hello, world! I'm Julien Wazné" property="og:site_name">
  
    <meta content="Xml files with Talend" property="og:title">
  
  
    <meta content="article" property="og:type">
  
  
    <meta content="How to read data from two joined input xml files and produce a xml file as output." property="og:description">
  
  
    <meta content="http://localhost:4000/xml-files-with-talend/" property="og:url">
  
  
    <meta content="2018-02-07T22:00:00+01:00" property="article:published_time">
    <meta content="http://localhost:4000/about/" property="article:author">
  
  
    <meta content="http://localhost:4000/assets/img/talend_xml.png" property="og:image">
  
  
    
  
  
    
    <meta content="xml" property="article:tag">
    
    <meta content="talend" property="article:tag">
    
  

  
    <meta name="twitter:card" content="How to read data from two joined input xml files and produce a xml file as output.">
  
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
  
    <meta name="twitter:title" content="Xml files with Talend">
  
  
    <meta name="twitter:url" content="http://localhost:4000/xml-files-with-talend/">
  
  
    <meta name="twitter:description" content="How to read data from two joined input xml files and produce a xml file as output.">
  
  
    <meta name="twitter:image:src" content="http://localhost:4000/assets/img/talend_xml.png">
  

	<meta name="description" content="How to read data from two joined input xml files and produce a xml file as output.">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicon/apple-touch-icon-114x114.png">
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">
</head>

<body>

  <div class="wrapper">
    <aside class="sidebar">
  <header>
    <div class="about">
      <div class="cover-author-image">
        <a href="/"><img src="/assets/img/julien-wazne.png" alt="Julien Wazné"></a>
      </div>
      <div class="author-name">Julien Wazné</div>
      <p>I am an open source business intelligence specialist and a full-stack web developer. Always hungry to learn new things.</p>
    </div>
  </header> <!-- End Header -->
  <footer>
    <section class="contact">
      <h3 class="contact-title">Contact me</h3>
      <ul>
        
          <!-- <li><a href="https://twitter.com/artemsheludko_" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>           -->
        
        
          <!-- <li><a href="https://facebook.com/" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a></li> -->
        
        
          <li class="github"><a href="http://github.com/jwazne" target="_blank"><i class="fa fa-github"></i></a></li>
        
        
          <li class="linkedin"><a href="https://in.linkedin.com/in/julienwazne" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        
        
          <li class="email"><a href="mailto:jwazne@gmail.com"><i class="fa fa-envelope-o"></i></a></li>
        
      </ul>
    </section> <!-- End Section Contact -->
    <div class="copyright">
      <p>2018 &copy; Julien Wazné</p>
    </div>
  </footer> <!-- End Footer -->
</aside> <!-- End Sidebar -->
<div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    <div class="page-cover-image">
      <img class="page-image" src=/assets/img/talend_xml.png alt="Xml files with Talend">
    </div> <!-- End Page Cover Image -->
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">Xml files with Talend</h1>
        <div class="page-date"><span>2018, Feb 07&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <h2 id="what-we-want-to-do">What we want to do</h2>
<p>To join 2 input xml files to produce an output xml file</p>

<h2 id="what-well-need">What we’ll need</h2>
<p>Talend v6.4.1. installed (should work with previous version of Talend too)
Two xml files :</p>
<ul>
  <li><strong>authors.xml</strong> containing a list of authors like this:</li>
</ul>

<p><img src="https://cdn.filestackcontent.com/pcraQnAlRdmstaCxXq8W" alt="authors.xml.png" /></p>

<ul>
  <li><strong>books.xml</strong> containing a list of books with authorId referencing an author in authors.xml file, like this:
<img src="https://cdn.filestackcontent.com/s625Eh8jRMGmFNurjkre" alt="books.xml.png" /></li>
</ul>

<h2 id="the-results">The results</h2>
<p>We should get a new Xml file <strong>books_with_authorname.xml</strong> containing a list of book with author name, like this:
<img src="https://cdn.filestackcontent.com/VpvQbZkRkG4Haoi68Hdg" alt="job_design_run2.png" /></p>

<p>It is the same file as <strong>books.xml</strong> plus the authorname field and minus the publish_date and description fields.</p>

<h2 id="step-1--configure-metadata">Step 1 : Configure metadata</h2>
<p>First things first.
Always configure the metadata before doing anything on Talend.</p>

<h3 id="metadata-for-authorsxml-file">Metadata for authors.xml file</h3>
<p>Right click on <strong>Metadata &gt; File xml</strong> and choose <strong>Create file xml</strong>
<img src="https://cdn.filestackcontent.com/PblV8XekTL68Rgho76Di" alt="xml_file_metadata.png" /></p>

<p>Enter the file information as below and click <strong>Next</strong>:
<img src="https://cdn.filestackcontent.com/DidazPDvQLarij1pltJJ" alt="authors_xml_file_metadata_step1.png" /></p>

<p>Mark the file as Input XML and click <strong>Next</strong>:
<img src="https://cdn.filestackcontent.com/9n4cmOaYTuyMonINrhDc" alt="authors_xml_file_metadata_step2.png" /></p>

<p>Browse to the authors.xml file. If it is a valid Xml file, the structure of the file should appears.
Choose the right encoding, then click <strong>Next</strong>
<img src="https://cdn.filestackcontent.com/OEgJ4snjQFmGF8lZSQci" alt="authors_xml_file_metadata_step3.png" /></p>

<p>Here’s the step to tell Talend how it should read the Xml file:
<img src="https://cdn.filestackcontent.com/rPgLENOITuifRS42Mfuk" alt="authors_xml_file_metadata_step4-1.png" /></p>

<p>Here we want to get all the authors information, so we need to loop on the **<author>** tag of the xml file and select the id attribute (marked as @id) and the **<authorName>** and **<authorAge>** tags.
  Here how it looks:
  ![authors_xml_file_metadata_step4-2.png](https://cdn.filestackcontent.com/6sTJbz0dTUa43xmiT7da)</authorAge></authorName></author></p>

<p>Great ! Click on <strong>Next</strong> when you get the desired output.</p>

<blockquote>
  <p>N.B. : At this stage we could export this file configuration into a context by clicking on <strong>Export as context</strong> button. But I will skip this part since I think it deserves a dedicated post to explain context environments.</p>
</blockquote>

<p>Let’s move on the final step to create our xml file metadata that we will use in all of our Talend jobs.
Here you can rename the fields and correct/change the data type of each fields.</p>
<blockquote>
  <p>N.B. : Can be useful specially to increase size of String fields and to change date pattern of Date fields.</p>
</blockquote>

<p><img src="https://cdn.filestackcontent.com/lsKUqnVFSuu1bjnSwRIs" alt="authors_xml_file_metadata_step5.png" />
For example in the picture above I’ve changed the size of authorName from 20 to 50 characters. Indeed Talend estimates the number of characters by using data sample, so it can under-estimate the maximum number of characters for a field.</p>

<p>When you’re done, click the <strong>Finish</strong> button</p>

<p>You have now a new Xml file metadata named authors that you can use in all Xml related components in all jobs you want.</p>

<p><img src="https://cdn.filestackcontent.com/l1NjLSNnSZO2sifBNbFd" alt="authors_xml_file_metadata_done.png" /></p>

<h3 id="metadata-for-booksxml-file">Metadata for books.xml file</h3>

<p>For the books.xml file steps are the same.
Here is the configuration of the Step 4 for the books.xml file:
<img src="https://cdn.filestackcontent.com/EZ5yxBAjReu1C6yOD5U8" alt="books_xml_file_metadata_step4.png" /></p>

<h3 id="metadata-for-books_with_authorsxml-file-output-file">Metadata for books_with_authors.xml file (output file)</h3>
<p>Right click on <strong>Metadata &gt; File xml</strong> and choose <strong>Create file xml</strong>
<img src="https://cdn.filestackcontent.com/PblV8XekTL68Rgho76Di" alt="xml_file_metadata.png" /></p>

<p>Enter the file information as below and click <strong>Next</strong>:
<img src="https://cdn.filestackcontent.com/6dHqaiIaSTulWzRN9fnT" alt="output_file_metadata_step1.png" /></p>

<p>Mark the file as <strong>Output XML</strong> and click <strong>Next</strong>:
<img src="https://cdn.filestackcontent.com/IVVFdWORFaTIgDFXbkAw" alt="output_file_metadata_step2.png" /></p>

<p>Choose to create the file manually since it doesn’t exist yet.
<img src="https://cdn.filestackcontent.com/BZTxrmeMTyKwcwS1nnax" alt="output_file_metadata_step3.png" /></p>
<blockquote>
  <p>N.B. : you could also create a result xml file and use it by choosing <strong>Create from a file</strong></p>
</blockquote>

<p>Click on <strong>Schema Management</strong> button and add fields to build the schema of the output file:
<img src="https://cdn.filestackcontent.com/wPQ1IwEnQbyf0Q7gywpM" alt="output_file_metadata_step4-1.png" /></p>

<p>Change the name of the root node by “catalog” and right-click on the row and choose Add Sub-element:
<img src="https://cdn.filestackcontent.com/yDHVRbC2TsqjgkskHG1v" alt="output_file_metadata_step4-2.png" />
Name the element <strong>book</strong> and click <strong>Ok</strong>
Right-click on the book element and choose Add Attribute named id.
Drag and drop the book_id field on the left to the column Related Column of the @id attribute.
<img src="https://cdn.filestackcontent.com/ie5dwm0jSOCPTLBxb0LQ" alt="output_file_metadata_step4-3.png" />
This will map the book_id field to the book attribute in the output xml file.</p>

<p>Then create sub-element for each fields under the book element
<img src="https://cdn.filestackcontent.com/kbHilyaeTFC2KcIyysDg" alt="output_file_metadata_step4-4.png" /></p>

<p>Finally set the book element as loop element
<img src="https://cdn.filestackcontent.com/1Of5BtFSSWmKLynFVys6" alt="output_file_metadata_step4-5.png" /></p>

<p>Here’s the summary of all the steps:
<img src="https://cdn.filestackcontent.com/4fOrzV2bTH4qYG4Yusps" alt="output_file_metadata_summary.png" /></p>

<p>When done click <strong>Next</strong>
Review the name of the fields and data type and length and click <strong>Finish</strong>
<img src="https://cdn.filestackcontent.com/eckr3aO3SVORzWymXPdQ" alt="output_file_metadata_step5.png" /></p>

<h2 id="step-2--place-components-on-the-job">Step 2 : Place components on the job</h2>
<p>Create a job named <strong>j_xml_output</strong> and drag each of the metadata created in step 1 to the job canvas. For both authors and books choose tFileInputXML component when asked, for books_with_authors it won’t ask since it is an output xml file metadata.
<img src="https://cdn.filestackcontent.com/hQ7igGaATUq205G4dMgV" alt="component_to_choose.png" />
You should end up with the following:
<img src="https://cdn.filestackcontent.com/8e6NXdDqTlCe2lvvy05A" alt="job_design_putting_metadata.png" /></p>

<h2 id="step-3--joining-input-files">Step 3 : Joining input files</h2>
<p>To join the two input xml files we’ll use the tMap component. Find it on the Palette and add it to the design job between the two input files and the ouptut file:
<img src="https://cdn.filestackcontent.com/41MRd4UjReK9Cmj1XSEY" alt="job_design_adding_tmap.png" /></p>

<p>Right click on the books component and choose <strong>Row &gt; Main</strong>
<img src="https://cdn.filestackcontent.com/SiJMO3ebTnWN9rusPROH" alt="job_design_main_flow1.png" />
A path should appears inviting you to link the book component with another one. Go to the tMap component and left-click.
<img src="https://cdn.filestackcontent.com/3dYnZCZrTyWP4jz0AOz8" alt="job_design_main_flow2.png" />
This should link the book component to the tMap component so that the both components now are a sub-job.
<img src="https://cdn.filestackcontent.com/sJu6DAQmRn67UaWfL36R" alt="job_design_main_flow3.png" /></p>

<p>Do the exact same link with the authors component. You should get the following:
<img src="https://cdn.filestackcontent.com/MtLgNoXSHgGymydrppAA" alt="job_design_main_flow4.png" />
You can see on the screenshot above that the link between authors and tMap is dashed. This means the authors flow is a lookup.
The main flow remains the books list but we are going to look into authors file to get some information to complete the books list.</p>

<p>Double click on the tMap component. It should open the tMap editor.
Drag the authorId field of the row1 flow (books) to the Expr. key of the id field of the row2 flow (authors).</p>

<blockquote>
  <p>N.B. : for more convenience rename rowX with a more meaningful name. For example here row1 should have been renamed to books and row2 to authors. The cool thing is that you can do it after linking fields. So you’ll see the modification in the next screenshots.</p>
</blockquote>

<p>So after having map the authorId of the books with the id of the authors, you should end up with this:
<img src="https://cdn.filestackcontent.com/Fp1Dp4bwQluoWyLIRSox" alt="job_design_tmap1.png" /></p>

<p>And that’s all for a basic join of two xml files. By clicking on the little magnifying glass with a red 1 in it you can set options of the join. Basically it is the same thing as <strong>inner join</strong> or <strong>left join</strong> in the SQL world.</p>

<h2 id="step-4--inserting-output-and-mapping-fields">Step 4 : Inserting output and mapping fields</h2>
<p>Now link the tMap component with the output xml file component
<img src="https://cdn.filestackcontent.com/YIrPNs5AQL3OqLglQaQY" alt="job_design_tmap2.png" /></p>

<p>Double click on the tMap component to open the tMap editor and map the input fields with the output fields like this:
<img src="https://cdn.filestackcontent.com/bZGCpoUSayIEMq8yvbu5" alt="job_design_tmap3.png" /></p>

<p>Validate your changes by clicking the <strong>Ok</strong> button</p>

<h2 id="step-5--run-the-job-and-get-result-file">Step 5 : Run the job and get result file</h2>
<p>Below the job canvas, open the Run (Job j_xml_lookup) tab and hit the <strong>Run</strong> button
You should get the final results:
<img src="https://cdn.filestackcontent.com/SkvknDPVQduzT0VTsPpr" alt="job_design_run1.png" />
The number of rows written in the output file is the same number of rows as the main flow (books) produced (since no filter has been set).</p>

<p>Open the /…/books_with_authors.xml file, you should get the expected result:
<img src="https://cdn.filestackcontent.com/8e0gWfTRUSjGLL2XODsw" alt="job_design_run2.png" /></p>

<p>That’s the end of the post.</p>

<p>Don’t hesitate to reach me for more explaination or if some elements are incorrect.</p>

<p>Have fun with Talend !</p>

<p><strong>The end</strong></p>

      <div class="page-footer">
        <div class="page-share">
          <!-- <a href="https://twitter.com/intent/tweet?text=Xml files with Talend&url=http://localhost:4000/xml-files-with-talend/" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=http://localhost:4000/xml-files-with-talend/" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=http://localhost:4000/xml-files-with-talend/" title="Share on Google+" rel="nofollow" target="_blank">Google+</a> -->
        </div>
        <div class="page-tag">
          
            <a href="/tags#xml" class="tag">&#35; xml</a>
          
            <a href="/tags#talend" class="tag">&#35; talend</a>
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
